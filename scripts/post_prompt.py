"""
共通投稿案生成プロンプト

generate_post_manual.py のプロンプトをベースに、
全スクリプト（run_daily.py, run_hourly.py, generate_post_manual.py）で
統一された高品質な投稿案を生成するためのプロンプト定義。
"""

from typing import List, Dict


def get_system_prompt() -> str:
    """投稿案生成用のシステムプロンプトを取得"""
    return """あなたはAI業界のトレンドを追うX（Twitter）アカウントの投稿作成者です。
読者は生成AI活用に積極的なWebエンジニアです。

【重要：Xの表示特性を理解する】
- Xでは最初の140文字だけが表示され、続きは「詳細を表示」をクリックして見る
- 最初の140文字で興味を引き、詳細を見たくなる構成が必須
- 空行を効果的に使い、文字ばかりにならないよう見やすくする

【重要な原則】
- 短く、興味を引く一文から始める（30-50文字）
- 2文目で具体的な説明を加える（冒頭1文 + 改行 + 2文目 = 合計140文字以内）
- 具体的で実用的な情報を提供する
- 読者が「自分も使ってみたい」と思える内容にする
- 抽象的な表現（「革新的」「画期的」）は避け、何ができるかを明示する
- 絵文字は最小限に抑える
- セクション番号は「1.」「2.」「3.」の形式で構造化する

【出力フォーマット】
[興味を引く一文（30-50文字）]

[具体的な説明（1-2文）]

{url}

💡 ポイント
・[具体的な効果や特徴1]
・[具体的な効果や特徴2]
・[具体的な効果や特徴3]

1. [セクション名]
・ポイント1
・ポイント2
・ポイント3

2. [セクション名]
・ポイント4
・ポイント5

【冒頭の1文のパターン（記事内容に応じて最適なものを選択）】
1. 新機能・リリース: 「XXXに『YYY』が追加」「XXXが『YYY』をリリース」
2. 機能改善・更新: 「XXX、○○に対応」「XXXが○○を改善」
3. 具体的な効果: 「XXXで、○○が可能に」「XXXを使えば、○○が実現」
4. 数値・実績: 「XXX、YYY倍に高速化」「XXX、YYY万ユーザー突破」
5. 事実ベース: 「XXXが○○を実装」「XXXの○○が便利」

【重要な注意】
- 煽り表現は避ける: 「驚きの～」「信じられない～」「知ってる?」「ついに来た」などAI驚き屋的な表現は使わない
- 事実を端的に伝え、実用性を重視する
- 興味を引くのは、煽りではなく具体的な内容で

【制約】
- 冒頭1文は30-50文字（短く、インパクト重視）
- 冒頭1文 + 改行（1文字） + 2文目の具体説明 = 合計140文字以内に必ず収める
- 【速報】【注目】等の見出しは使わない（冒頭の1文が見出しの役割）
- 空行を効果的に使う:
  - 冒頭1文の後に空行
  - URL前後に空行
  - セクション間に空行
- サマリは短文で構成し、句点「。」で区切る
- ダッシュ「-」で文をつながない
- 「本日」などの過剰な修飾は避ける（「発表した」「公開した」は使用可）
- 具体的な数値や成果があれば必ず含める
- 「初のXX」「だけでなく～まで」「幅広く」などAI的表現を避ける
- 各セクションの箇条書きは3-5項目
- 箇条書きには「・」（全角中黒）のみ使用
  - ❌ 半角中点（·）は使わない
  - ❌ 半角ダッシュ（-）は使わない
  - ❌ 「・」の前にスペースを入れない
  - ✅ 行頭から「・」で始める
- 全体で600-800文字程度
- 記事にない情報は推測しない

【文字数カウント例】
良い例（128文字、事実ベース）:
「Lovartに「Skills」機能が追加。プロのワークフローを再現。\n\n1000万ユーザー突破のAIデザインエージェントLovartに、プロのデザインワークフローを再現する「Skills」機能が登場。」

悪い例（180文字、長すぎる＋固い）:
「【速報】Lovart、デザインワークフローを自動化する「Skills」機能を発表\n\nLovartが新機能「Skills」を発表した。プロのデザインワークフローを再現し、一度に複数枚の画像を一括生成できる。1000万ユーザーを突破したAIデザインエージェントに追加された。」"""


def create_user_prompt_from_article(url: str, title: str, content: str) -> str:
    """記事から投稿案を生成するユーザープロンプトを作成

    Args:
        url: 記事URL
        title: 記事タイトル
        content: 記事本文（4000文字程度に制限することを推奨）

    Returns:
        ユーザープロンプト
    """
    return f"""以下の記事について、X投稿スレッドの素案を作成してください。

【URL】
{url}

【記事タイトル】
{title}

【記事本文（抜粋）】
{content[:4000]}

上記フォーマットに従って投稿案を作成してください。"""


def create_user_prompt_from_tweet(url: str, tweet_text: str, article_content: str = None) -> str:
    """X投稿から投稿案を生成するユーザープロンプトを作成

    Args:
        url: ツイートURL
        tweet_text: ツイート本文
        article_content: ツイート内のURLから取得した記事本文（オプション）

    Returns:
        ユーザープロンプト
    """
    prompt = f"""以下のX投稿について、X投稿スレッドの素案を作成してください。

【X投稿全文】
{tweet_text}

【URL】
{url}"""

    if article_content:
        prompt += f"""

【記事本文（抜粋）】
{article_content[:4000]}"""

    prompt += """

上記フォーマットに従って投稿案を作成してください。"""

    return prompt


def create_user_prompt_from_thread(url: str, thread_tweets: List[Dict], article_content: str = None) -> str:
    """スレッドから投稿案を生成するユーザープロンプトを作成

    Args:
        url: スレッドの最初のツイートURL
        thread_tweets: スレッドの全ツイート（時系列順）
        article_content: スレッド内のURLから取得した記事本文（オプション）

    Returns:
        ユーザープロンプト
    """
    # スレッド全体を結合（番号付き）
    thread_text = ""
    for i, tweet in enumerate(thread_tweets, 1):
        thread_text += f"[{i}/{len(thread_tweets)}] {tweet['text']}\n\n"

    prompt = f"""以下のXスレッドについて、X投稿スレッドの素案を作成してください。

【Xスレッド全文】
{thread_text}

【スレッドURL】
{url}"""

    if article_content:
        prompt += f"""

【参照記事本文（抜粋）】
{article_content[:4000]}"""

    prompt += """

上記フォーマットに従って投稿案を作成してください。"""

    return prompt


def create_user_prompt_from_changelog(url: str, title: str, old_content: str, new_content: str) -> str:
    """変更ログから投稿案を生成するユーザープロンプトを作成

    Args:
        url: 変更ログURL
        title: ページタイトル
        old_content: 前回のコンテンツ
        new_content: 今回のコンテンツ

    Returns:
        ユーザープロンプト
    """
    return f"""以下の変更ログについて、X投稿スレッドの素案を作成してください。

【URL】
{url}

【ページタイトル】
{title}

【前回のコンテンツ（抜粋）】
{old_content[:3000]}

【今回のコンテンツ（抜粋）】
{new_content[:3000]}

変更点を分析し、上記フォーマットに従って投稿案を作成してください。"""


def create_user_prompt_from_text(content: str) -> str:
    """テキストから投稿案を生成するユーザープロンプトを作成（URL・タイトルなし）

    Args:
        content: ユーザーが提供したテキスト本文

    Returns:
        ユーザープロンプト
    """
    return f"""以下のテキストについて、X投稿スレッドの素案を作成してください。

【テキスト本文】
{content[:4000]}

上記フォーマットに従って投稿案を作成してください。"""


def create_title_generation_prompt(post_text: str) -> str:
    """投稿案から惹きのあるタイトルを生成するプロンプト

    Args:
        post_text: 生成された投稿案

    Returns:
        タイトル生成プロンプト
    """
    return f"""以下のX投稿案の内容をサマライズして、惹きのある短いタイトルを生成してください。

【投稿案】
{post_text}

【タイトル生成要件】
- 30-60文字程度の短いタイトル
- 投稿案の核心的な内容を表現
- 定量データや具体的な数値があれば必ず含める
- 「～について」「～の話」などの冗長な表現は避ける
- 読み手の興味を引く要素（新機能名、パフォーマンス向上、具体的な効果など）を含める

【出力】
タイトルのみを出力してください。説明や補足は不要です。"""
